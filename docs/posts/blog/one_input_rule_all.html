<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-06-24">

<title>One Input to Rule Them All: Smarter Dashboards with Simple Controls (Tableau and Power BI)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f3c2ea88cadbcfb37ba28ffa2c97cfc1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../armchair_tb_project.html">
 <span class="dropdown-text">Armchair TB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/pepfar_tb_example.html">
 <span class="dropdown-text">Mozambique TB/HIV Coinfection Overview (Demo)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/lab_times_tableau_example.html">
 <span class="dropdown-text">Visualizing Lab Testing Turnaround Times</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://kirstinlyon.shinyapps.io/kickout/">
 <span class="dropdown-text">Kickout</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/summer_olympian_p1.html">
 <span class="dropdown-text">So, You Want to be a Summer Olympian? (Part 1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/summer_olympian_p2.html">
 <span class="dropdown-text">So, You Want to be a Summer Olympian? (Part 2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/club_members.html">
 <span class="dropdown-text">Where are all the members?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/next_club.html">
 <span class="dropdown-text">Find Your Next Club in Denmark</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/project/management_dashboard.html">
 <span class="dropdown-text">Management Dashboard</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../guides.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/KirstinLyon" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/kirstin-lyon-0320012a/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://medium.com/@kirstin.lyon" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-medium"></i></a>
    <a href="mailto:kirstin@mltwelve.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">One Input to Rule Them All: Smarter Dashboards with Simple Controls (Tableau and Power BI)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Tableau</div>
    <div class="quarto-category">Power BI</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 24, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>When you’re building dashboards, especially the kind people want to use, one of the most useful tricks in the book is using a single control to drive multiple elements. Whether you’re working in Tableau or Power BI, both tools let you do this, just in slightly different ways.</p>
<p>Different use cases include:</p>
<ul>
<li>Switch Between Data Types or Business Units</li>
<li>Language or Locale Selection</li>
<li>Time Granularity Selector (Month, Quarter, Year)</li>
<li>Pick Your KPI</li>
<li>What-If or Scenario Testing</li>
<li>Switch Perspectives (Executive vs.&nbsp;Operational)</li>
</ul>
<p><strong>Why This Is So Useful</strong></p>
<p>Having one control keeps things simple, clean, and easy to navigate.</p>
<p>From the builder’s side, it’s also a huge win: fewer visuals to maintain, fewer things to break when the data or logic changes, and much better scalability when stakeholders inevitably ask for “just one more metric.”</p>
<p>Both Tableau and Power BI make this kind of flexibility possible:</p>
<ul>
<li>In Tableau, you’d use parameters and calculated fields to drive your views, often combined with Show/Hide containers to swap visuals on the fly.</li>
<li>In Power BI, it’s about using a disconnected table, a slicer, and some DAX to dynamically update visuals without duplication.</li>
</ul>
<p><strong>Walkthrough: Dynamic Metric Switching</strong></p>
<p>Using the PEPFAR dataset for SADC countries (e.g.&nbsp;South Africa, Mozambique, Zambia), we want to let users select one indicator, like TB_STAT %, TB_STAT_POS %, Linkage % or HTS_TST_POS % — and have the entire dashboard update accordingly.</p>
<p>Let’s break it down for both Power BI and Tableau.</p>
<section id="tableau" class="level2">
<h2 class="anchored" data-anchor-id="tableau">Tableau</h2>
<ol type="1">
<li>In Tableau’s Data pane, go to any blank space, and click the small dropdown arrow in the top-right of the panel and choose “Create Parameter…”. Set up the parameters as follows:</li>
</ol>
<br>

<div style="text-align: center;">
    <img src="../../images/one_input_rule_all/one_input_rule_all_001.png" width="600">
</div>

<br>
<ol start="2" type="1">
<li>Create the necessary calculations: typically including one for the indicator value, as well as separate ones for the numerator, denominator, and any relevant text fields. All calculations should reference the same parameter, ensuring the entire dashboard updates consistently based on a single selection.</li>
</ol>
<p>First, create the values:</p>
<pre><code>//Create three calculations

Indicator %

case [select indicator]
when 1 then [hiv_positivity_rate]
when 2 then [treatment_linkage %]
when 3 then [TB_STAT %]
when 4 then [TB_STAT_POS %]
END

numerator
case [select indicator]
when 1 then [HTS_TST_POS]
when 2 then [TX_NEW]
when 3 then [TB_STAT_N]
when 4 then [TB_STAT_POS]
END

denominator
case [select indicator]
when 1 then [HTS_TST]
when 2 then [HTS_TST_POS]
when 3 then [TB_STAT_D]
when 4 then [TB_STAT_N]
END</code></pre>
<p>Next, create calculations for text:</p>
<pre><code>//Create three calculations

Indicator description: 
case [select indicator]
when 1 then "HIV Positivity %"
when 2 then "Linkage to Treatment %"
when 3 then "TB patients with known HIV status %"
when 4 then "TB patients who are HIV-positive %"
END

Numerator description:
case [select indicator]
when 1 then "Number of positive tests"
when 2 then "Number of newly enrolled in HIV treatment"
when 3 then "Number of TB patients with known HIV status"
when 4 then "Number of TB patients who are HIV-positive"

END

Denominator description:
case [select indicator]
when 1 then "Total tests conducted"
when 2 then "Number who tested positive"
when 3 then "Total patients with TB"
when 4 then "Number of TB patients with a known HIV status"
END</code></pre>
<ol start="3" type="1">
<li>Build your charts and dashboard. Whenever you need to display a value or label that should respond to the parameter, use your calculated field instead of hardcoding a specific measure or dimension. This applies to tooltips as well; they can dynamically reflect the selected option using the same calculations.</li>
</ol>
<br>
<div style="text-align: center;">
    <img src="../../images/one_input_rule_all/one_input_rule_all_002.png" width="800">
</div>
<br>
<ol start="4" type="1">
<li>Build the dashboard and add the parameter control to enable dynamic interaction.</li>
</ol>
<br>
<div style="text-align: center;">
    <img src="../../images/one_input_rule_all/one_input_rule_all_003.png" width="800">
</div>
<br>
<p>The live version is available on <a href="https://public.tableau.com/views/one_input_rule_all/one_input_rule_all_demo?:language=en-GB&amp;:sid=&amp;:redirect=auth&amp;:display_count=n&amp;:origin=viz_share_link">Tableau Public</a>.</p>
<div id="viz1750786252808" class="tableauPlaceholder" style="position: relative">
<noscript>
<a href="#"><img src="https://public.tableau.com/static/images/on/one_input_rule_all/one_input_rule_all_demo/1_rss.png" alt="one_input_rule_all_demo " style="border: none"></a>
</noscript>
<object class="tableauViz" style="display:none;">
<p><param name="host_url" value="https%3A%2F%2Fpublic.tableau.com%2F"> <param name="embed_code_version" value="3"> <param name="site_root" value=""><param name="name" value="one_input_rule_all/one_input_rule_all_demo"><param name="tabs" value="no"><param name="toolbar" value="yes"><param name="static_image" value="https://public.tableau.com/static/images/on/one_input_rule_all/one_input_rule_all_demo/1.png"> <param name="animate_transition" value="yes"><param name="display_static_image" value="yes"><param name="display_spinner" value="yes"><param name="display_overlay" value="yes"><param name="display_count" value="yes"><param name="language" value="en-US"></p>
</object>
</div>
<script type="text/javascript">                   
    var divElement = document.getElementById('viz1750786252808');                    
    var vizElement = divElement.getElementsByTagName('object')[0]; 
    var targetWidth = 800; // Set your target width
    var originalWidth = 1600; // Original width
    var originalHeight = 927; // Original height
    
    // Calculate scale ratio
    var scaleRatio = targetWidth / originalWidth;
  
    // Apply scale transformation
    vizElement.style.transform = 'scale(' + scaleRatio + ')';
    vizElement.style.transformOrigin = 'top left'; // Keep the scaling aligned to the top left
    vizElement.style.width = originalWidth + 'px'; // Maintain original width
    vizElement.style.height = originalHeight + 'px'; // Maintain original height
    vizElement.style.overflow = 'hidden'; // Hide any overflow

    var scriptElement = document.createElement('script');                    
    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    
    vizElement.parentNode.insertBefore(scriptElement, vizElement);                
</script>
</section>
<section id="power-bi" class="level2">
<h2 class="anchored" data-anchor-id="power-bi">Power BI</h2>
<p>In Power BI, achieving the same effect takes a bit more setup, but it is possible. There are a couple of approaches, but this walkthrough focuses on creating parameters using a disconnected table and DAX, a method that provides the greatest flexibility.</p>
<ol type="1">
<li>Create a dataset in Excel with the necessary columns — in this example, five: <strong>indicator</strong>, <strong>numerator</strong>, <strong>numerator_description</strong>, <strong>denominator</strong>, and <strong>denominator_description</strong>. Include in these columns all the text and values you want the parameter to reference. Your dataset should look something like the example below.</li>
</ol>
<br>
<div style="text-align: center;">
    <img src="../../images/one_input_rule_all/one_input_rule_all_004.png" width="800">
</div>
<br>
<ol start="2" type="1">
<li>Import this dataset into Power BI as a separate table (via File → Get Data → Excel). There’s no need to create a relationship between this table and your main data model.</li>
</ol>
<br>
<div style="text-align: center;">
    <img src="../../images/one_input_rule_all/one_input_rule_all_005.png" width="400">
</div>
<br>
<ol start="3" type="1">
<li>Create a table to store your value and description calculations. In Power BI’s Model View, click New Table and enter the following formula to create a single-row, single-column table with a blank value:</li>
</ol>
<pre><code>param_demo = Row("Column", BLANK())</code></pre>
<p>This creates a table named param_demo with one row and a column called “Column” initialised as blank.</p>
<ol start="4" type="1">
<li>Create your calculations by right-clicking the new table param_demoand selecting New Measure. Use a SWITCH statement in your DAX to reference values from your parameter dataset. This approach lets you dynamically control which measure or description is displayed based on the selected parameter. Below are the three calculations needed to update each value.</li>
</ol>
<pre><code>SelectedIndicator = SWITCH (
    SELECTEDVALUE ( param_demo[indicator] ),
    "HIV Positivity %", [HTS_TST_POS %],
    "Linkage to Treatment %", [linkage %],
    "TB patients with known HIV status %", [TB_STAT %],
    "TB patients who are HIV-positive %", [TB_STAT_POS %],
    BLANK ()
)

SelectedNumerator = 
SWITCH (
    SELECTEDVALUE ( param_demo[indicator] ),
    "HIV Positivity %", [HTS_TST_POS],
    "Linkage to Treatment %", [TX_NEW],
    "TB patients with known HIV status %", [TB_STAT_N],
    "TB patients who are HIV-positive %", [TB_STAT_POS],
    BLANK ()
)

SelectedDenominator = 
SWITCH (
    SELECTEDVALUE ( param_demo[indicator] ),
    "HIV Positivity %", [HTS_TST],
    "Linkage to Treatment %", [HTS_TST_POS],
    "TB patients with known HIV status %", [TB_STAT_D],
    "TB patients who are HIV-positive %", [TB_STAT_N],
    BLANK ()
)</code></pre>
<ol start="5" type="1">
<li>Create your charts, slicers, and other visuals as usual. Instead of using the raw indicator fields from your dataset, use the calculated measures you created. Make sure to add a slicer linked to the indicator parameter; this slicer drives the calculations, so without it, your visuals will remain blank.</li>
</ol>
<br>
<div style="text-align: center;">
    <img src="../../images/one_input_rule_all/one_input_rule_all_006.png" width="800">
</div>
<br>
<p>The live version is available <a href="https://app.powerbi.com/view?r=eyJrIjoiMjVjODA1Y2QtNmEzMy00YmZlLTgwYTgtMjk5Yjc5YjBmYTliIiwidCI6IjQzYTkwMTI5LTk0NWYtNDYwOS1hYzI2LTdmMjMzZGNiYzA4NSIsImMiOjl9">online</a>.</p>
<iframe title="one_input_rule_all" width="800" height="600" src="https://app.powerbi.com/view?r=eyJrIjoiMjVjODA1Y2QtNmEzMy00YmZlLTgwYTgtMjk5Yjc5YjBmYTliIiwidCI6IjQzYTkwMTI5LTk0NWYtNDYwOS1hYzI2LTdmMjMzZGNiYzA4NSIsImMiOjl9" frameborder="0" allowfullscreen="true">
</iframe>
<p>Both Tableau and Power BI have their strengths when it comes to using parameters.</p>
<p>Tableau offers great flexibility, allowing a single parameter to dynamically update multiple calculations across the dashboard. This makes it straightforward to create consistent, interactive experiences.</p>
<p>Power BI, meanwhile, lets you store parameter options in a dedicated table. This approach simplifies managing, documenting, and updating parameter values over time. However, in both tools, adding new logic typically requires manually updating calculations with SWITCH or CASE statements, so extending functionality means editing formulas directly.</p>
<p>A key challenge with Power BI is that setting up parameter-like controls, especially using external tables, is not very intuitive. Additionally, these controls can’t be used to dynamically update elements like axes or legends, which limits their flexibility. In contrast, Tableau’s parameter controls feel more integrated and user-friendly, making it easier to create seamless interactivity across the dashboard.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>